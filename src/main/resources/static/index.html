<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hellzapoppin' Member's Card</title>
    <style>
        /* ================= ベース設定 ================= */
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            width: 100vw;
            height: 100dvh; /* モバイルのアドレスバー考慮 */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Arial Black', sans-serif;
        }

        /* ================= カードのコンテナ ================= */
        /* ここが新しい考え方です。
           カード自体を「コンテナ」として定義し、中身はこの箱のサイズだけを見て
           文字サイズなどを自動決定します。画面サイズは気にしません。 */
        .card-container {
            /* 横縦比 16:9 に固定 (画像Bの比率) */
            aspect-ratio: 16 / 9;
            
            /* ベースのデザイン */
            background-image: url('/assets/members_bg.png');
            background-size: cover;
            background-position: center bottom;
            border-radius: 5cqw; /* 角丸も相対サイズに */
            border: 0.8cqw solid #ff3366; /* 枠線の太さも相対サイズ */
            box-shadow: 0 0 10cqw rgba(255, 0, 0, 0.4);
            
            /* コンテナクエリの魔法を有効化 */
            container-type: size;
            position: relative;
            overflow: hidden;
            
            /* デフォルト（PC・横持ち）の設定 */
            width: 95vw; /* 画面幅の95% */
            max-height: 95vh; /* ただし画面高さからはみ出さない */
        }

        /* ================= 縦持ち（Portrait）時の強制回転 ================= */
        @media (orientation: portrait) {
            .card-container {
                /* 幅と高さを入れ替えるような設定 */
                width: 95vh;  /* 画面の「高さ」をカードの幅として使う */
                max-width: none;
                max-height: 95vw; /* 画面の「幅」をカードの高さ制限にする */
                
                /* 90度回転させて中央配置 */
                transform: rotate(90deg);
            }
        }

        /* ================= 中身のレイアウト (すべて cqw 単位) ================= */
        /* cqw = Container Query Width (コンテナの幅の1%) 
           これを使うと、カードが拡大縮小してもレイアウトが絶対に崩れません。 */

        /* テキストの影共通 */
        .text-shadow {
            filter: drop-shadow(0 0.2cqw 0.4cqw rgba(0,0,0,0.9));
        }

        /* 1. ロゴ (左上) */
        .header {
            position: absolute;
            top: 8%;
            left: 5%;
            text-align: left;
        }
        .group-name {
            font-size: 5.5cqw; /* 幅の5.5%の大きさ */
            font-weight: 900;
            background: linear-gradient(to right, #fff 20%, #ff3366 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            line-height: 1;
        }
        .card-title {
            font-size: 2cqw;
            color: #ff99cc;
            letter-spacing: 0.3cqw;
            margin-top: 1cqw;
        }

        /* 2. ID (右上) */
        .id-container {
            position: absolute;
            top: 8%;
            right: 5%;
            text-align: right;
        }
        .id-label {
            font-size: 1.5cqw;
            color: #cccccc;
            margin-bottom: 0.5cqw;
        }
        #user-id {
            font-family: monospace;
            font-size: 3.5cqw; /* IDの文字サイズ */
            color: #fff;
            letter-spacing: 0.2cqw;
            font-weight: bold;
        }

        /* 3. ポイント (中央) */
        .points-container {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 100%;
        }
        .points-label {
            font-size: 2.2cqw;
            color: #ddd;
            letter-spacing: 0.5cqw;
            margin-bottom: -1cqw; /* 数字との距離を詰める */
            font-weight: bold;
        }
        .points-value {
            font-size: 16cqw; /* 超巨大文字 */
            line-height: 1.1;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 3cqw rgba(255, 0, 0, 0.8), 0 0 1cqw #fff;
        }
        .points-unit {
            font-size: 4cqw;
            color: #ff3366;
            margin-left: 1cqw;
        }

        /* ローディングアニメ */
        .loading {
            font-size: 5cqw;
            animation: blink 0.8s infinite alternate;
        }
        @keyframes blink { from { opacity: 0.3; } to { opacity: 1.0; } }

    </style>
</head>
<body>

<div class="card-container text-shadow">

    <div class="header">
        <div class="group-name">HELLZAPOPPIN'</div>
        <div class="card-title">OFFICIAL MEMBER'S CARD</div>
    </div>

    <div class="id-container">
        <div class="id-label">MEMBER ID</div>
        <div id="user-id">Checking...</div>
    </div>

    <div class="points-container">
        <div class="points-label">CURRENT POINTS</div>
        <div class="points-value" id="points-display">
            <span class="loading">...</span>
        </div>
    </div>
</div>

<script>
    // ================= データ取得処理 =================
    // レイアウト調整のJSは全廃止しました。CSSだけで動きます。

    const pathParts = window.location.pathname.split('/');
    const cid = pathParts[pathParts.length - 1];
    const userIdElement = document.getElementById('user-id');

    if (cid && cid !== 'c') {
         userIdElement.textContent = cid.toUpperCase();
    } else {
         userIdElement.textContent = 'UNKNOWN';
    }

    async function fetchPoints() {
        if (!cid || cid === 'c') {
            document.getElementById('points-display').innerHTML = '<span style="font-size:5cqw">ERROR</span>';
            return;
        }
        try {
            const response = await fetch(`/api/card?cid=${cid}`);
            if (response.ok) {
                const data = await response.json();
                const point = data.point !== undefined ? data.point : 0;
                const formattedPoint = point.toLocaleString();
                document.getElementById('points-display').innerHTML =
                    `${formattedPoint}<span class="points-unit">pt</span>`;
            } else {
                document.getElementById('points-display').innerHTML = '<span style="font-size:5cqw">ERROR</span>';
            }
        } catch (e) {
            console.error(e);
            document.getElementById('points-display').innerHTML = '<span style="font-size:5cqw">OFFLINE</span>';
        }
    }
    fetchPoints();
</script>
</body>
</html>